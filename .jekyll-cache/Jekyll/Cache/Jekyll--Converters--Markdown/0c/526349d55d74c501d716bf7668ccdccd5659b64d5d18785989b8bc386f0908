I"ÇK<h2 id="instala√ß√£o-do-apache-hadoop-28x-em-modo-single-node">Instala√ß√£o do Apache Hadoop 2.8.x em modo Single Node</h2>

<h4 id="requisitos-iniciais">Requisitos iniciais:</h4>

<ul>
  <li>1) Tenha o Java 7+ instalado</li>
  <li>2) Tenha o servidor SSH devidamente instalado e configurado</li>
  <li>3) Tenha a vari√°vel JAVA_HOME configurada</li>
  <li>4) Configure o SSH para o acesso sem senha com o endere√ßo <em>localhost</em></li>
</ul>

<p>*ps: Este tutorial foi testado com o sistema operacional Ubuntu 16.04 e 14.04. Caso deseje configurar em uma vers√£o mais antiga, recente ou em outro SO, pequenas mudan√ßas podem ocorrer nos procedimentos apresentados.</p>

<h3 id="tldr">TL;DR</h3>

<p>O projeto Apache Hadoop √© um <em>software</em> de c√≥digo aberto mantido pela Apache Foundation que tem como prop√≥sito fornecer uma implementa√ß√£o de c√≥digo aberto do modelo de programa√ß√£o <em>MapReduce</em> de forma confi√°vel e escal√°vel. O Hadoop √© projetado para ampliar o processamento de um √∫nico servidor em milhares de m√°quinas, onde cada uma das m√°quinas oferecem poder de processamento e armazenamento local. Esta ferramenta √© utilizada para processamento em <em>batch</em> de grandes volumes de dados (<em>Big Data</em>). Atualmente, o Apache Hadoop √© uma das ferramentas mais conhecidas para processamento distribu√≠do, mas existem outras ferramentas similares que se integram ao Hadoop, como o <strong>Apache Spark</strong>, <strong>Apache Storm</strong> e dentre outros.</p>

<p>*para mais informa√ß√µes a respeito do Apache Hadoop acessem o site <a href="http://hadoop.apache.org/">http://hadoop.apache.org/</a></p>

<h3 id="lets-get-started">Let‚Äôs get started</h3>

<p>Neste tutorial voc√™ ir√° aprender a configurar o Apache Hadoop no modo <em>Single Node</em>. Montando um ambiente capaz de executar seus primeiros <em>scripts</em> em <em>MapReduce</em>.</p>

<p style="text-align: center;">
  <img src="/assets/images/coding-girl-fast.gif" style="width: 60%;" />
</p>

<h3 id="instale-o-java-jdk-e-configure-o-java_home">Instale o Java JDK e configure o JAVA_HOME</h3>

<p>Instale o Java 8 com o seguinte comando:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# apt-get <span class="nb">install </span>openjdk-8-jdk
</code></pre></div></div>

<p>Verifique a instala√ß√£o do Java:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# java <span class="nt">-version</span>
</code></pre></div></div>

<p>Adicionar o JAVA_HOME na vari√°vel PATH:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# vim /etc/environments
</code></pre></div></div>

<p>Adicionar ao final do arquivo a vari√°vel JAVA_HOME:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# <span class="nv">JAVA_HOME</span><span class="o">=</span><span class="s2">"/usr/lib/jvm/java-8-openjdk-amd64"</span>
</code></pre></div></div>

<p>Atualize os √≠ndices da vari√°vel de ambiente:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# <span class="nb">source</span> /etc/environment
</code></pre></div></div>

<p>Verifique se o Path est√° correto:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# <span class="nb">echo</span> <span class="nv">$JAVA_HOME</span>
</code></pre></div></div>

<h3 id="instale-e-configure-o-servidor-ssh-sem-senha">Instale e Configure o Servidor SSH (Sem Senha)</h3>

<p>Caso n√£o tenha instalado o ssh, instale o servidor ssh com o seguinte comando:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# apt-get <span class="nb">install </span>ssh
</code></pre></div></div>

<p>Verifique se a m√°quina tem acesso a ssh sem senha no localhost:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# ssh localhost
</code></pre></div></div>

<p>Caso seja solicitado uma senha, fa√ßa o seguinte procedimento:</p>

<p>Gere uma chave p√∫blica de acesso ao ssh</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-P</span> <span class="s2">""</span>
</code></pre></div></div>

<p>Agora com a chave gerada vamos adicionar ela ao diret√≥rio de chaves autorizadas:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# <span class="nb">cat</span> <span class="nv">$HOME</span>/.ssh/id_rsa.pub <span class="o">&gt;&gt;</span> <span class="nv">$HOME</span>/.ssh/authorized_keys
</code></pre></div></div>

<h3 id="configure-o-apache-hadoop-single-node">Configure o Apache Hadoop (Single Node)</h3>

<p>Fa√ßa o download do Apache Hadoop, neste caso a vers√£o 2.8.1:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# wget http://mirror.nbtelecom.com.br/apache/hadoop/common/hadoop-2.8.1/hadoop-2.8.1.tar.gz
</code></pre></div></div>

<p>Descompacte o Apache Hadoop no diret√≥rio /opt:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# <span class="nb">tar</span> <span class="nt">-zxvf</span> hadoop-2.8.1.tar.gz
</code></pre></div></div>

<p>Agora vamos configurar as vari√°veis de ambiente:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#caso voc√™ prefira que todos usu√°rios do sistema tenham as vari√°veis de ambiente</span>
~# vim /etc/profile 
</code></pre></div></div>

<p>ou</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#caso voc√™ prefira que apenas o seu usu√°rio tenham as vari√°veis de ambiente</span>
~# vim ~/.bashrc 
</code></pre></div></div>

<p>Adicione ao final do arquivo os seguintes vari√°veis de ambiente:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#HADOOP VARIABLES START
export JAVA_HOME=caminho_para_o_java_home
export HADOOP_INSTALL=caminho_para_o_haddop
export PATH=$PATH:$HADOOP_INSTALL/bin
export PATH=$PATH:$HADOOP_INSTALL/sbin
export HADOOP_MAPRED_HOME=$HADOOP_INSTALL
export HADOOP_COMMON_HOME=$HADOOP_INSTALL
export HADOOP_HDFS_HOME=$HADOOP_INSTALL
export YARN_HOME=$HADOOP_INSTALL
export HADOOP_COMMON_LIB_NATIVE_DIR=$HADOOP_INSTALL/lib/native
export HADOOP_OPTS="-Djava.library.path=$HADOOP_INSTALL/lib"
#HADOOP VARIABLES END
</code></pre></div></div>

<p>OBS: Substitua <strong><em>caminho_para_o_java_home</em></strong> e <strong><em>caminho_para_o_hadoop</em></strong> pelos seus respectivos paths ;)</p>

<p>Atualize os √≠ndices das vari√°veis de ambiente:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# <span class="nb">source</span> ~/.bashrc
</code></pre></div></div>

<p>ou</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# <span class="nb">source</span> /etc/profile
</code></pre></div></div>

<p>Agora vamos editar o arquivo de vari√°veis de ambiente do Hadoop:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# vim hadoop-2.8.1/etc/hadoop/hadoop-env.sh
</code></pre></div></div>

<p>Edite a vari√°vel de ambiente JAVA_HOME:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# <span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/lib/jvm/java-8-openjdk-amd64
</code></pre></div></div>

<p>Vamos criar o diret√≥rio onde ser√° o ponto de montagem do sistemas de arquivos do Hadoop o HDFS:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# <span class="nb">mkdir</span> <span class="nt">-p</span> ~/hadoop_store/hdfs/namenode
~# <span class="nb">mkdir</span> <span class="nt">-p</span> ~/hadoop_store/hdfs/datanode
</code></pre></div></div>

<p>Vamos configurar o arquivo hdfs-site.xml com o caminho das pastas criadas:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# vim hadoop-2.8.1/etc/hadoop/hdfs-site.xml
</code></pre></div></div>

<p>Adicione as seguintes propriedades:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;property&gt;</span>
  <span class="nt">&lt;name&gt;</span>dfs.replication<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;value&gt;</span>1<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;description&gt;</span>Default block replication.
  The actual number of replications can be specified when the file is created.
  The default is used if replication is not specified in create time.
  <span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>dfs.namenode.name.dir<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;value&gt;</span>file:######NAMENODE_FOLDER_PATH######<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>dfs.datanode.data.dir<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;value&gt;</span>file:######DATANODE_FOLDER_PATH######<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
</code></pre></div></div>

<p>*ps: a tag <code class="highlighter-rouge">&lt;/property&gt;</code> deve ficar dentro de uma tag <code class="highlighter-rouge">&lt;configuration&gt;&lt;/configuration&gt;</code></p>

<p>Crie um diret√≥rio tempor√°rio na pasta de instala√ß√£o do Hadoop:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# <span class="nb">mkdir</span> <span class="nt">-p</span> ~/hadoop_store/hdfs/tmp
</code></pre></div></div>

<p>Vamos configurar o arquivo core-site.xml</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# vim hadoop-2.8.1/etc/hadoop/core-site.xml
</code></pre></div></div>

<p>Adicione as seguintes propriedades</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;property&gt;</span>
  <span class="nt">&lt;name&gt;</span>hadoop.tmp.dir<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;value&gt;</span>######TMP_FOLDER_PATH######<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;description&gt;</span>A base for other temporary directories.<span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;/property&gt;</span>

 <span class="nt">&lt;property&gt;</span>
  <span class="nt">&lt;name&gt;</span>fs.default.name<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;value&gt;</span>hdfs://localhost:54310<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;description&gt;</span>The name of the default file system.  A URI whose
  scheme and authority determine the FileSystem implementation.  The
  uri's scheme determines the config property (fs.SCHEME.impl) naming
  the FileSystem implementation class.  The uri's authority is used to
  determine the host, port, etc. for a filesystem.<span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
</code></pre></div></div>

<p>*ps: a tag <code class="highlighter-rouge">&lt;/property&gt;</code> deve ficar dentro de uma tag <code class="highlighter-rouge">&lt;configuration&gt;&lt;/configuration&gt;</code></p>

<p>Configure o arquivo mapred-site.xml:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# <span class="nb">cp </span>hadoop-2.8.1/etc/hadoop/mapred-site.xml.template hadoop-2.8.1/etc/hadoop/mapred-site.xml
</code></pre></div></div>

<p>Adicione a seguinte propriedade:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;property&gt;</span>
  <span class="nt">&lt;name&gt;</span>mapred.job.tracker<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;value&gt;</span>localhost:54311<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;description&gt;</span>The host and port that the MapReduce job tracker runs
  at.  If "local", then jobs are run in-process as a single map
  and reduce task.
  <span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
</code></pre></div></div>

<p>*ps: a tag <code class="highlighter-rouge">&lt;/property&gt;</code> deve ficar dentro de uma tag <code class="highlighter-rouge">&lt;configuration&gt;&lt;/configuration&gt;</code></p>

<p>Configure o arquivo o arquivo yarn-site.xml:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# vim yarn-site.xml
</code></pre></div></div>

<p>Adicione as seguintes propriedades:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;property&gt;</span>
          <span class="nt">&lt;name&gt;</span>yarn.resourcemanager.hostname<span class="nt">&lt;/name&gt;</span>
          <span class="nt">&lt;value&gt;</span>frontend<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;description&gt;</span>The hostname of the RM.<span class="nt">&lt;/description&gt;</span>
  <span class="nt">&lt;/property&gt;</span>

  <span class="nt">&lt;property&gt;</span>
           <span class="nt">&lt;name&gt;</span>yarn.nodemanager.aux-services<span class="nt">&lt;/name&gt;</span>
           <span class="nt">&lt;value&gt;</span>mapreduce_shuffle<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;/property&gt;</span>

  <span class="nt">&lt;property&gt;</span>
           <span class="nt">&lt;name&gt;</span>yarn.nodemanager.aux-services.mapreduce.shuffle.class<span class="nt">&lt;/name&gt;</span>
           <span class="nt">&lt;value&gt;</span>org.apache.hadoop.mapred.ShuffleHandler<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
</code></pre></div></div>

<p>*ps: a tag <code class="highlighter-rouge">&lt;/property&gt;</code> deve ficar dentro de uma tag <code class="highlighter-rouge">&lt;configuration&gt;&lt;/configuration&gt;</code></p>

<p>Formate o sistema de arquivos HDFS:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# hadoop namenode <span class="nt">-format</span>
</code></pre></div></div>

<p>Inicie os servi√ßos do Hadoop:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# start-dfs.sh <span class="o">&amp;&amp;</span> start-yarn.sh
</code></pre></div></div>

<p>Verifique os processos do Hadoop:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# jps
</code></pre></div></div>

<p>O console deve aparecer uma sa√≠da semelhante a essa:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>9757 Jps
8950 DataNode
9145 SecondaryNameNode
9438 NodeManager
8799 NameNode
9311 ResourceManager
</code></pre></div></div>

<p><em>Importante que apare√ßa os processos <strong>*DataNode</strong></em>, <strong><em>SecondaryNameNode</em></strong>, <strong><em>NodeManager</em></strong>, <strong><em>NameNode</em></strong> e <strong><em>ResourceManager</em></strong>.</p>

<h2 id="configurar-o-memory-heap-da-jvm">Configurar o Memory Heap da JVM</h2>

<p>Caso enfrente algum problema com rela√ß√£o ao tamanho do <em>heap</em> de mem√≥ria da JVM</p>

<p>1¬™ Etapa:</p>

<p>Adicione esta linha no arquivo /etc/profile:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">JVM_ARGS</span><span class="o">=</span><span class="s2">"-Xms1024m -Xmx1024m"</span>
</code></pre></div></div>

<p>Esta mudan√ßa muda o heap de mem√≥ria do Java para 1024 mb. Por padr√£o √© 128 mb.</p>

<p>Agora vamos atualizar os √≠ndices do arquivo /etc/profile:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# <span class="nb">source</span> /etc/profile
</code></pre></div></div>

<p>2¬™ Etapa:</p>

<p>Adicione ou edite a seguinte vari√°vel de ambiente:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# export HADOOP_CLIENT_OPTS="-Xmx1024m $HADOOP_CLIENT_OPTS"
</code></pre></div></div>

<p>3¬™ Etapa:</p>

<p>Adicione a seguinte propriedade ao arquivo mapred-site.xml:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;name&gt;</span>mapred.child.java.opts<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;value&gt;</span>-Xmx1024m<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
</code></pre></div></div>
<p>*ps: a tag <code class="highlighter-rouge">&lt;/property&gt;</code> deve ficar dentro de uma tag <code class="highlighter-rouge">&lt;configuration&gt;&lt;/configuration&gt;</code></p>

<p>Se tudo estiver ok, pronto temos o Apache Hadoop configurado em modo <em>Single Node</em> ;)<br /></p>

<p style="text-align: center;">
  <img src="/assets/images/elephant-crazy.gif" style="width: 50%;" />
</p>

<p>O artigo Configura√ß√£o do Apache Hadoop em Multi Node est√° dispon√≠vel no seguinte <a href="/config-hadoop-multi-node/" target="_blank">link</a>.</p>

<h2 id="disclaimer">Disclaimer</h2>

<p>Material desenvolvido durante o meu Mestrado no Instituto de Ci√™ncias Matem√°ticas e de Computa√ß√£o da Universidade de S√£o Paulo (<a href="http://icmc.usp.br/" target="_blank">ICMC-USP</a>). Al√©m disso, fa√ßo um agradecimento em especial ao Laborat√≥rio de Sistemas Distribu√≠dos e Programa√ß√£o Concorrente (<a href="http://lasdpc.icmc.usp.br/" target="_blank">LaSDPC</a>), o qual fa√ßo parte que me permitiu a cria√ß√£o deste material. Por fim, informo que √© permitido livremente a reprodu√ß√£o integral deste material desde que sejam feitas as devidas refer√™ncias ao autor ;)</p>

<h2 id="refer√™ncias">Refer√™ncias</h2>

<p>[1] Apache Foundation. Hadoop: <strong><em>Setting up a Single Node Cluster</em></strong>. Acessado em Agosto de 2016. Dispon√≠vel em: <a href="http://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-common/SingleCluster.html">http://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-common/SingleCluster.html</a></p>

<p>[2] Rajesh N. <strong><em>‚ÄúJava Heap space Out Of Memory Error‚Äù while running a mapreduce program</em></strong>. Acessado em Agosto de 2016. Dispon√≠vel em:  <a href="http://stackoverflow.com/questions/30295606/java-heap-space-out-of-memory-error-while-running-a-mapreduce-program">http://stackoverflow.com/questions/30295606/java-heap-space-out-of-memory-error-while-running-a-mapreduce-program</a></p>
:ET